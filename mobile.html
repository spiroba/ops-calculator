<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ü—Ä–µ–º–∏–π –û–ü–° | –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #1928DC 0%, #86BBFF 100%);
            min-height: 100vh;
            padding: 5px;
            padding-top: 85px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ */
            font-size: 16px; /* –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(25, 40, 220, 0.2);
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 50%, #5c6bc0 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px 20px 0 0;
            box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.2), 
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            font-weight: 600;
            opacity: 0.95;
            line-height: 1.2;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
            line-height: 1.3;
        }

        .main-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .left-panel, .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(25, 40, 220, 0.1);
            border: 1px solid rgba(25, 40, 220, 0.1);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1928DC;
            display: flex;
            align-items: center;
            gap: 8px;
            line-height: 1.2;
        }

        .position-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .position-option {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .position-option:hover, .position-option:active {
            border-color: #1928DC;
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(25, 40, 220, 0.15);
        }

        .position-option.active {
            border-color: #1928DC;
            background: linear-gradient(135deg, #1928DC 0%, #86BBFF 100%);
            color: white;
        }

        .position-option input {
            display: none;
        }

        .position-icon {
            font-size: 1.8rem;
            margin-bottom: 4px;
        }

        .position-name {
            font-weight: 600;
            font-size: 0.9rem;
            line-height: 1.2;
            text-align: center;
        }

        .operations-grid, .kpi-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .operation-item, .kpi-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
        }

        .operation-item:hover, .kpi-item:hover {
            border-color: #1928DC;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(25, 40, 220, 0.1);
        }

        .operation-label, .kpi-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1928DC;
            font-size: 1rem;
            line-height: 1.3;
        }

        .operation-rate {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 10px;
            min-height: 35px;
            line-height: 1.3;
            display: flex;
            align-items: center;
        }

        .operation-input, .kpi-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            min-height: 48px; /* Touch-friendly —Ä–∞–∑–º–µ—Ä */
            -webkit-appearance: none;
            appearance: none;
        }

        .operation-input:focus, .kpi-input:focus {
            outline: none;
            border-color: #1928DC;
            box-shadow: 0 0 0 3px rgba(25, 40, 220, 0.15);
        }

        .kpi-inputs {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .kpi-input {
            flex: 1;
            padding: 12px;
            font-size: 0.95rem;
        }

        .salary-field, .position-field {
            background: rgba(134, 187, 255, 0.1) !important;
            border: 2px solid #1928DC !important;
            min-height: 120px !important;
            padding: 16px !important;
        }

        .salary-field .kpi-label::after,
        .position-field .kpi-label::after {
            content: " *";
            color: #ff4757;
            font-weight: bold;
        }

        .salary-field.error,
        .position-field.error {
            border-color: #ff4757 !important;
            background: #ffe6e6 !important;
        }

        .kpi-input[type="number"], .kpi-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            min-height: 48px;
        }

        select.kpi-input {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%231928DC' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 16px center;
            background-repeat: no-repeat;
            background-size: 20px;
            padding-right: 48px;
        }

        .pvz-wb-params {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .pvz-wb-params input,
        .pvz-wb-params select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
            min-height: 48px;
        }

        .pvz-wb-params input:focus,
        .pvz-wb-params select:focus {
            outline: none;
            border-color: #1928DC;
            box-shadow: 0 0 0 3px rgba(25, 40, 220, 0.15);
        }

        .results {
            background: linear-gradient(135deg, rgba(25, 40, 220, 0.1) 0%, rgba(134, 187, 255, 0.2) 100%);
            border: 2px solid rgba(25, 40, 220, 0.2);
            border-radius: 15px;
            padding: 20px;
            min-height: 250px;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1928DC;
            margin-bottom: 16px;
            text-align: center;
            line-height: 1.2;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(25, 40, 220, 0.2);
            color: #2B2D34;
            font-size: 0.95rem;
            line-height: 1.3;
        }

        .result-item:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.15rem;
            background: rgba(25, 40, 220, 0.1);
            color: #1928DC;
            padding: 16px;
            border-radius: 10px;
            margin-top: 12px;
            border: 2px solid rgba(25, 40, 220, 0.3);
        }





        /* Touch —Å—Ç–∏–ª–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è */
        .position-option,
        .operation-input,
        .kpi-input,
        .recalc-button {
            -webkit-tap-highlight-color: rgba(25, 40, 220, 0.2);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* –£–±–∏—Ä–∞–µ–º —Å–∏–Ω–∏–µ —Ä–∞–º–∫–∏ –Ω–∞ iOS */
        input, select, textarea, button {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        .position-option:active {
            transform: scale(0.98);
        }

        .operation-item:active,
        .kpi-item:active {
            transform: scale(0.99);
        }

        .recalc-button:active {
            transform: scale(0.97);
        }



        .positions-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.75rem;
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }

        .positions-table th,
        .positions-table td {
            border: 1px solid #e2e8f0;
            padding: 6px 4px;
            text-align: center;
            vertical-align: middle;
            min-width: 50px;
        }

        .positions-table th:nth-child(1),
        .positions-table td:nth-child(1) {
            width: 35px;
            min-width: 35px;
        }

        .positions-table th:nth-child(2),
        .positions-table td:nth-child(2) {
            width: 120px;
            min-width: 120px;
            text-align: left;
            white-space: normal;
            word-wrap: break-word;
        }

        .positions-table th:nth-child(3),
        .positions-table td:nth-child(3) {
            width: 70px;
            min-width: 70px;
        }

        .positions-table th:nth-child(4),
        .positions-table td:nth-child(4) {
            width: 40px;
            min-width: 40px;
        }

        .positions-table th:nth-child(n+5),
        .positions-table td:nth-child(n+5) {
            width: 50px;
            min-width: 50px;
        }

        .positions-table th {
            background: rgba(25, 40, 220, 0.1);
            font-weight: 600;
            color: #1928DC;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .positions-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 400px) {
            .positions-table {
                font-size: 0.7rem;
            }
            
            .positions-table th,
            .positions-table td {
                padding: 4px 2px;
            }
            
            .positions-table th:nth-child(2),
            .positions-table td:nth-child(2) {
                width: 100px;
                min-width: 100px;
            }
        }

        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }

        .table-wrapper::-webkit-scrollbar {
            height: 8px;
        }

        .table-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background: #1928DC;
            border-radius: 4px;
        }

        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: #0f1a9e;
        }

        /* –î–æ–±–∞–≤–∏–º —Ç–µ–Ω—å –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        .table-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 20px;
            background: linear-gradient(to left, rgba(0,0,0,0.1), transparent);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .table-wrapper:hover::after {
            opacity: 1;
        }



        /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∏—Ç–æ–≥–æ–≤–æ–π –ø—Ä–µ–º–∏–µ–π */
        .fixed-summary {
            position: fixed;
            top: 5px;
            right: 5px;
            left: 5px;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #48dbfb 100%);
            color: white;
            padding: 14px 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
            z-index: 1000;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            min-width: auto;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .fixed-summary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }

        .summary-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 6px;
            opacity: 0.95;
            letter-spacing: 0.5px;
        }

        .summary-amount {
            font-size: 1.6rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            letter-spacing: 0.5px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ */
        .recalc-button {
            margin-left: 8px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #283593 0%, #5c6bc0 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(40, 53, 147, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 40px;
        }

        .recalc-button:hover, .recalc-button:active {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(40, 53, 147, 0.4);
            background: linear-gradient(135deg, #3949ab 0%, #7986cb 100%);
        }

        .recalc-icon {
            font-size: 1rem;
            animation: none;
            transition: transform 0.3s ease;
        }

        .recalc-button:hover .recalc-icon {
            transform: rotate(180deg);
        }

        .recalc-text {
            font-size: 0.9rem;
            letter-spacing: 0.3px;
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• –£–°–¢–†–û–ô–°–¢–í */
        @media (max-width: 768px) {
            body {
                padding: 0px;
                padding-top: 85px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ */
            }
            
            .header {
                padding: 12px 8px;
                margin-bottom: 8px;
            }
            
            .header h1 {
                font-size: 1.3rem;
                margin-bottom: 6px;
            }
            
            .header p {
                font-size: 0.8rem;
            }
            
            .main-content {
                padding: 8px 5px;
                gap: 12px;
            }
            
            .section {
                padding: 12px 8px;
            }
            
            .section-title {
                font-size: 1.1rem;
                margin-bottom: 12px;
                gap: 6px;
            }
            
            .position-selector {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .position-option {
                padding: 12px;
                min-height: 85px;
                gap: 6px;
            }
            
            .position-icon {
                font-size: 1.5rem;
            }
            
            .position-name {
                font-size: 0.8rem;
            }
            
            .operation-item, .kpi-item {
                padding: 14px;
                min-height: 110px;
            }
            
            .operation-label, .kpi-label {
                font-size: 0.95rem;
                margin-bottom: 6px;
            }
            
            .operation-rate {
                font-size: 0.8rem;
                min-height: 30px;
                margin-bottom: 8px;
            }
            
            .operation-input, .kpi-input {
                padding: 10px 14px;
                font-size: 1rem;
                min-height: 44px;
            }
            
            .kpi-input {
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .results {
                padding: 12px 8px;
                min-height: 200px;
            }
            
            .results-title {
                font-size: 1.2rem;
                margin-bottom: 12px;
                flex-direction: column;
                gap: 8px;
                align-items: center;
                display: flex;
            }
            
            .result-item {
                padding: 10px 0;
                font-size: 0.9rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            .result-item:last-child {
                padding: 14px;
                font-size: 1.1rem;
                margin-top: 10px;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            

            
            .recalc-button {
                margin-left: 0;
                margin-top: 8px;
                padding: 6px 12px;
                font-size: 0.8rem;
                min-height: 36px;
                gap: 4px;
            }
            
            .recalc-text {
                display: none;
            }
            
            .recalc-icon {
                font-size: 0.9rem;
            }
            
            .modal-content {
                margin: 5px;
                padding: 16px;
                max-width: calc(100% - 10px);
                max-height: calc(100vh - 10px);
                overflow-y: auto;
            }
        }

        /* –û–ß–ï–ù–¨ –ú–ê–õ–ï–ù–¨–ö–ò–ï –≠–ö–†–ê–ù–´ */
        @media (max-width: 480px) {
            .position-selector {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .position-option {
                min-height: 75px;
                padding: 10px;
            }
            
            .position-icon {
                font-size: 1.3rem;
            }
            
            .position-name {
                font-size: 0.75rem;
            }
            
            .operation-input, .kpi-input {
                padding: 8px 12px;
                min-height: 40px;
            }
            
            .fixed-summary {
                padding: 8px 12px;
            }
            
            .summary-title {
                font-size: 0.8rem;
            }
            
            .summary-amount {
                font-size: 1.2rem;
            }
        }

        /* –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–ê–Ø –û–†–ò–ï–ù–¢–ê–¶–ò–Ø –ù–ê –ú–û–ë–ò–õ–¨–ù–´–• */
        @media (max-width: 896px) and (orientation: landscape) {
            body {
                padding-top: 70px;
            }
            
            .fixed-summary {
                padding: 8px 16px;
            }
            
            .summary-title {
                font-size: 0.8rem;
                margin-bottom: 2px;
            }
            
            .summary-amount {
                font-size: 1.2rem;
            }
            
            .main-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –∏—Ç–æ–≥–æ–≤–æ–π –ø—Ä–µ–º–∏–µ–π -->
    <div class="fixed-summary" id="fixedSummary">
        <div class="summary-title">üí∞ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–µ–º–∏—è</div>
        <div class="summary-amount" id="summaryAmount">0 ‚ÇΩ</div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ü—Ä–µ–º–∏–π –û–ü–°*</h1>
            <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 10px; font-style: italic;">
                * –†–∞—Å—á–µ—Ç –Ω–æ—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–µ–º–∏–∏
            </p>
            
        </div>
        


        <div class="main-content">
            <div class="left-panel">
                <div class="section">
                    <div class="section-title">üë• –í—ã–±–æ—Ä –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</div>
                    <div class="position-selector">
                        <label class="position-option active" for="operator">
                            <input type="radio" id="operator" name="position" value="operator" checked>
                            <div class="position-icon">üë®‚Äçüíº</div>
                            <div class="position-name">–û–ø–µ—Ä–∞—Ç–æ—Ä</div>
                        </label>
                        <label class="position-option" for="nops_operational">
                            <input type="radio" id="nops_operational" name="position" value="nops_operational">
                            <div class="position-icon">üë®‚Äçüíª</div>
                            <div class="position-name">–ù–û–ü–° (–±–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤)</div>
                        </label>
                        <label class="position-option" for="nops_management">
                            <input type="radio" id="nops_management" name="position" value="nops_management">
                            <div class="position-icon">üë®‚Äçüíº</div>
                            <div class="position-name">–ù–û–ü–° (—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏)</div>
                        </label>
                        <label class="position-option" for="admin">
                            <input type="radio" id="admin" name="position" value="admin">
                            <div class="position-icon">üë®‚Äçüíº</div>
                            <div class="position-name">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        </label>
                        <label class="position-option" for="postman">
                            <input type="radio" id="postman" name="position" value="postman">
                            <div class="position-icon">üö∂‚Äç‚ôÇÔ∏è</div>
                            <div class="position-name">–ü–æ—á—Ç–∞–ª—å–æ–Ω</div>
                        </label>
                        <label class="position-option" for="chief_specialist">
                            <input type="radio" id="chief_specialist" name="position" value="chief_specialist">
                            <div class="position-icon">üë®‚Äçüîß</div>
                            <div class="position-name">–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</div>
                        </label>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">üíº –û–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥</div>
                    <div class="operations-grid" id="operationsGrid"></div>
                </div>
            </div>

            <div class="right-panel">
                <div class="section" id="kpiSection">
                    <div class="section-title">üìä –ö–ü–ò –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</div>
                    <div class="kpi-grid" id="kpiGrid"></div>
                </div>

                <div class="section" id="coefficientsSection">
                    <div class="section-title" id="coefficientsTitle">‚öôÔ∏è –ö–æ–º–∞–Ω–¥–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã</div>
                    <div class="kpi-grid" id="coefficientsGrid"></div>
                </div>

                <div class="section" id="bankRewardsSection" style="display: none;">
                    <div class="section-title">üè¶ –ê–≥–µ–Ω—Ç—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –±–∞–Ω–∫–∞</div>
                    <div style="font-size: 0.85rem; color: #666; margin-bottom: 15px; text-align: center; font-style: italic;">
                        (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ–ø–ª–∞—Ç—ã —Ç—Ä—É–¥–∞ 1,0)
                    </div>
                    <div class="kpi-grid" id="bankRewardsGrid"></div>
                </div>

                <div class="results">
                    <div class="results-title">üìä –†–∞—Å—á–µ—Ç –ø—Ä–µ–º–∏–∏:
                        <button onclick="autoCalculate()" class="recalc-button">
                            <span class="recalc-icon">üîÑ</span>
                            <span class="recalc-text">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</span>
                        </button>
                    </div>
                    <div id="resultsContent">
                        <p style="text-align: center; color: #718096; margin-top: 50px;">
                            –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–µ–º–∏–∏
                        </p>
                    </div>
                </div>
            </div>




    <script>
        // v2.4: –ö–ü–ò —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç (–æ–∫–ª–∞–¥ √ó —Ä–∞–∑–º–µ—Ä_—Å—Ç–∞–≤–∫–∏) √ó –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç_–ö–ü–ò
        // –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è "–†–∞–∑–º–µ—Ä –æ–∫–ª–∞–¥–∞" –∏ "–†–∞–∑–º–µ—Ä –∑–∞–Ω–∏–º–∞–µ–º–æ–π —Å—Ç–∞–≤–∫–∏"
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –∏ –æ–ø–µ—Ä–∞—Ü–∏–π
        const POSITIONS_CONFIG = {
            operator: {
                name: "–û–ø–µ—Ä–∞—Ç–æ—Ä 1-3 –∫–ª–∞—Å—Å–∞",
                operations: [1, 3, 4, 5, 6, 7, 10, 11, 12, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24], // –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–æ–±–∞–≤–∏–ª 10(–º—É–ª—å—Ç–∏–ø–æ–¥–ø–∏—Å—å), 22(–≤—Ä—É—á–µ–Ω–∏–µ E–ö–û–ú)
                kpi: [], // –£ –æ–±—ã—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ù–ï–¢ –ö–ü–ò
                teamCoefficients: ["service", "speed_reception", "speed_delivery", "efficiency"], // –í—Å–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
                hasTeamBonus: false,
                hasBankRewards: true // –î–æ—Å—Ç—É–ø–Ω—ã –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            },
            nops_operational: {
                name: "–ù–û–ü–° –±–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (—Å–∞–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏)",
                operations: [1, 3, 4, 5, 6, 7, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 22, 23, 24, 25], // –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–æ–±–∞–≤–∏–ª 10(–º—É–ª—å—Ç–∏–ø–æ–¥–ø–∏—Å—å), 22(–≤—Ä—É—á–µ–Ω–∏–µ E–ö–û–ú)
                kpi: ["revenue", "csi", "online_rpo", "co1_co2"],
                teamCoefficients: [], // –ö–ü–ò —Å–∏—Å—Ç–µ–º–∞ –≤–º–µ—Å—Ç–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
                hasTeamBonus: false, // –ù–µ –ø–æ–ª—É—á–∞–µ—Ç % –æ—Ç –¥—Ä—É–≥–∏—Ö, —Å–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç
                hasBankRewards: true // –î–æ—Å—Ç—É–ø–Ω—ã –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            },
            nops_management: {
                name: "–ù–û–ü–° —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ (—Ç–æ–ª—å–∫–æ —Ä—É–∫–æ–≤–æ–¥—è—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏)",
                operations: [10, 11, 12, 13, 14, 25], // –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è 12 (–í—ã–¥–∞—á–∞ WB)
                kpi: ["revenue", "csi", "online_rpo", "co1_co2"],
                teamCoefficients: [], // –ö–ü–ò —Å–∏—Å—Ç–µ–º–∞ –≤–º–µ—Å—Ç–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
                hasTeamBonus: true, // –ü–æ–ª—É—á–∞–µ—Ç % –æ—Ç –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö
                isManagementOnly: true, // –¢–æ–ª—å–∫–æ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
                hasBankRewards: true // –î–æ—Å—Ç—É–ø–Ω—ã –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            },
            admin: {
                name: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
                operations: [3, 11, 16, 19, 20], // –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ 19 –∏ 20 (–ø—Ä–∏–µ–º –ø—Ä–µ–¥–æ–ø–ª–∞—á. –†–ü–û)
                kpi: ["revenue", "csi", "online_rpo"],
                teamCoefficients: ["service", "speed_reception", "speed_delivery"], // –ë–µ–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–µ—Å—Ç—å –ö–ü–ò)
                hasTeamBonus: false,
                hasBankRewards: true // –î–æ—Å—Ç—É–ø–Ω—ã –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            },
            postman: {
                name: "–ü–æ—á—Ç–∞–ª—å–æ–Ω",
                operations: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 25], // –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–æ–±–∞–≤–∏–ª 10(–º—É–ª—å—Ç–∏–ø–æ–¥–ø–∏—Å—å)
                kpi: [], // –£ –ø–æ—á—Ç–∞–ª—å–æ–Ω–∞ –ù–ï–¢ –ö–ü–ò
                teamCoefficients: ["service", "efficiency"], // –°–µ—Ä–≤–∏—Å + —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Ç–∏–ø–∞ 3-4)
                hasTeamBonus: false,
                hasBankRewards: true // –î–æ—Å—Ç—É–ø–Ω—ã –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            },
            chief_specialist: {
                name: "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –ø–æ—á—Ç–æ–≤–æ–π —Å–≤—è–∑–∏",
                operations: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25], // –í–°–ï 25 –æ–ø–µ—Ä–∞—Ü–∏–π
                kpi: [], // –£ –≥–ª–∞–≤–Ω–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ù–ï–¢ –ö–ü–ò
                teamCoefficients: ["service", "speed_reception", "speed_delivery", "efficiency"], // –í—Å–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
                hasTeamBonus: false,
                hasBankRewards: true // –î–æ—Å—Ç—É–ø–Ω—ã –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            }
        };

        const OPERATIONS_CONFIG = {
            1: { name: "–†–æ–∑–Ω–∏—Ü–∞ (—Ç–æ–≤–∞—Ä—ã)", rate: "3% –æ—Ç —Å—É–º–º—ã", type: "percent", value: 0.03, unit: "‚ÇΩ", operationType: 2 },
            2: { name: "–†–æ–∑–Ω–∏—Ü–∞ 16 –î–ü", rate: "5% –æ—Ç —Å—É–º–º—ã", type: "percent", value: 0.05, unit: "‚ÇΩ", operationType: 2 },
            3: { name: "–õ–æ—Ç–µ—Ä–µ–π–Ω—ã–µ –±–∏–ª–µ—Ç—ã", rate: "3% –æ—Ç —Å—É–º–º—ã", type: "percent", value: 0.03, unit: "‚ÇΩ", operationType: 2 },
            4: { name: "–ü–æ–¥–ø–∏—Å–∫–∞", rate: "2% –æ—Ç —Å—É–º–º—ã", type: "percent", value: 0.02, unit: "‚ÇΩ", operationType: 2 },
            5: { name: "–°–∏–º-–∫–∞—Ä—Ç–∞ —Ç–∏–ø 1", rate: "50‚ÇΩ/—à—Ç", type: "fixed", value: 50, unit: "—à—Ç", operationType: 2 },
            6: { name: "–°–∏–º-–∫–∞—Ä—Ç–∞ —Ç–∏–ø 2", rate: "30‚ÇΩ/—à—Ç", type: "fixed", value: 30, unit: "—à—Ç", operationType: 2 },
            7: { name: "–°–∏–º-–∫–∞—Ä—Ç–∞ —Ç–∏–ø 3", rate: "10‚ÇΩ/—à—Ç", type: "fixed", value: 10, unit: "—à—Ç", operationType: 2 },
            8: { name: "–î–æ—Å—Ç–∞–≤–∫–∞ –≥–∏–ø–µ—Ä–ª–æ–∫–∞", rate: "50‚ÇΩ/—à—Ç", type: "fixed", value: 50, unit: "—à—Ç", operationType: 2 },
            9: { name: "–ü–ª–∞—Ç–µ–∂ —Å –ú–ü–ö–¢", rate: "3‚ÇΩ/—à—Ç", type: "fixed", value: 3, unit: "—à—Ç", operationType: 2 },
            10: { name: "–ú—É–ª—å—Ç–∏–ø–æ–¥–ø–∏—Å—å", rate: "30‚ÇΩ/—à—Ç", type: "fixed", value: 30, unit: "—à—Ç", operationType: 2 },
            11: { name: "–ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä–∞", rate: "300‚ÇΩ/—á–µ–ª", type: "fixed", value: 300, unit: "—á–µ–ª", operationType: 1 }, // –ò–°–ü–†–ê–í–õ–ï–ù–û: —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ 1 –∏ 2 - —É–ø—Ä–æ—Å—Ç–∏–ª –¥–æ 1
            12: { name: "–í—ã–¥–∞—á–∞ WB", rate: "5‚ÇΩ/–∑–∞–∫–∞–∑", type: "fixed", value: 5, unit: "–∑–∞–∫–∞–∑", operationType: 1 }, // –ò–°–ü–†–ê–í–õ–ï–ù–û: —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ 1 –∏ 2 - —É–ø—Ä–æ—Å—Ç–∏–ª –¥–æ 1
            13: { name: "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ü–í–ó WB", rate: "–ø–æ —Ç–∞–±–ª–∏—Ü–µ", type: "formula", value: 0, unit: "—É—Å–ª—É–≥–∞", operationType: 1 }, // –ò–°–ü–†–ê–í–õ–ï–ù–û: —Ä–∞—Å—á–µ—Ç –ø–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
            14: { name: "–í–æ–∑–≤—Ä–∞—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å2—Å prof", rate: "1000‚ÇΩ/–∫–ª–∏–µ–Ω—Ç", type: "fixed", value: 1000, unit: "–∫–ª–∏–µ–Ω—Ç", operationType: 1 }, // –ò–°–ü–†–ê–í–õ–ï–ù–û: –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
            15: { name: "–ü—Ä–æ–¥–∞–∂–∞ EMS", rate: "40‚ÇΩ/—É—Å–ª—É–≥–∞", type: "fixed", value: 40, unit: "—É—Å–ª—É–≥–∞", operationType: 3 },
            16: { name: "–ü—Ä–∏–µ–º EMS –ø—Ä–µ–¥–æ–ø–ª–∞—á.", rate: "50‚ÇΩ/—à—Ç", type: "fixed", value: 50, unit: "—à—Ç", operationType: 3 },
            17: { name: "–ü—Ä–∏–µ–º –†–ü–û –ø–æ—Å—ã–ª–∫–∞", rate: "5‚ÇΩ/—à—Ç", type: "fixed", value: 5, unit: "—à—Ç", operationType: 3 },
            18: { name: "–ü—Ä–∏–µ–º –†–ü–û –ø–∏—Å—å–º–æ", rate: "0.5‚ÇΩ/—à—Ç", type: "fixed", value: 0.5, unit: "—à—Ç", operationType: 3 },
            19: { name: "–ü—Ä–∏–µ–º –ø—Ä–µ–¥–æ–ø–ª–∞—á. –†–ü–û –ø–æ—Å—ã–ª–∫–∞", rate: "7‚ÇΩ/—à—Ç", type: "fixed", value: 7, unit: "—à—Ç", operationType: 3 },
            20: { name: "–ü—Ä–∏–µ–º –ø—Ä–µ–¥–æ–ø–ª–∞—á. –†–ü–û –ø–∏—Å—å–º–æ", rate: "1‚ÇΩ/—à—Ç", type: "fixed", value: 1, unit: "—à—Ç", operationType: 3 },
            21: { name: "–í—Ä—É—á–µ–Ω–∏–µ –†–ü–û –ø–æ—Å—ã–ª–∫–∞", rate: "2‚ÇΩ/—à—Ç", type: "fixed", value: 2, unit: "—à—Ç", operationType: 4 },
            22: { name: "–í—Ä—É—á–µ–Ω–∏–µ E–ö–û–ú", rate: "0.5‚ÇΩ/—à—Ç", type: "fixed", value: 0.5, unit: "—à—Ç", operationType: 4 },
            23: { name: "–ü—Ä–∏–µ–º E–ö–û–ú", rate: "0.5‚ÇΩ/—à—Ç", type: "fixed", value: 0.5, unit: "—à—Ç", operationType: 3 },
            24: { name: "–ü—Ä–æ—á–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏", rate: "0.5‚ÇΩ/—à—Ç", type: "fixed", value: 0.5, unit: "—à—Ç", operationType: 2 },
            25: { name: "–£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö", rate: "10‚ÇΩ (–ù–û–ü–°) / 13‚ÇΩ (–ø–æ—á—Ç–∞–ª—å–æ–Ω)", type: "fixed", value: 10, unit: "—É—Å–ª—É–≥–∞", operationType: 1 } // –ò–°–ü–†–ê–í–õ–ï–ù–û: –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ 10‚ÇΩ
        };

        const KPI_CONFIG = {
            revenue: { name: "–ö–ü–ò –í—ã—Ä—É—á–∫–∞ –û–ü–°", placeholder: "% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", description: "80%+ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ö–ü–ò" },
            csi: { name: "–ö–ü–ò CSI –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å", placeholder: "% CSI", description: "–¢–∞–∫–∂–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Ç–∏–ø–∞ 2" },
            online_rpo: { name: "–ö–ü–ò –î–æ–ª—è –æ–Ω–ª–∞–π–Ω-–†–ü–û", placeholder: "% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è" },
            co1_co2: { name: "–ö–ü–ò CO1/CO2", placeholder: "% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è" }
        };

        // –í–µ—Å–∞ –ö–ü–ò –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º (20% –æ—Ç –æ–∫–ª–∞–¥–∞ –æ–±—â–∞—è —Å—É–º–º–∞ –ö–ü–ò)
        const KPI_WEIGHTS = {
            admin: {
                revenue: 0.30,      // 30% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
                csi: 0.40,          // 40% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò  
                online_rpo: 0.30    // 30% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
            },
            nops_operational: {
                revenue: 0.30,      // 30% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
                csi: 0.40,          // 40% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
                online_rpo: 0.15,   // 15% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
                co1_co2: 0.15       // 15% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
            },
            nops_management: {
                revenue: 0.30,      // 30% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
                csi: 0.40,          // 40% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
                online_rpo: 0.15,   // 15% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
                co1_co2: 0.15       // 15% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
            }
        };

        const TEAM_COEFFICIENTS_CONFIG = {
            service: { 
                name: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–µ—Ä–≤–∏—Å (CSI)", 
                placeholder: "–ë–∞–ª–ª—ã CSI",
                description: "–í–ª–∏—è–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ 2",
                type: "service"
            },
            speed_reception: { 
                name: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏–µ–º–∞", 
                placeholder: "–í—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö",
                description: "–í–ª–∏—è–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ 3. –ù–æ—Ä–º–∞: < 4 –º–∏–Ω = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, > 4 –º–∏–Ω = –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ",
                type: "speed_reception"
            },
            speed_delivery: { 
                name: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä—É—á–µ–Ω–∏—è", 
                placeholder: "–í—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö",
                description: "–í–ª–∏—è–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ 4. –ù–æ—Ä–º–∞: < 1:30 –º–∏–Ω = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, > 1:30 –º–∏–Ω = –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ", 
                type: "speed_delivery"
            },
            efficiency: { 
                name: "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –û–ü–°", 
                placeholder: "% –≤—ã—Ä—É—á–∫–∏",
                description: "–í–ª–∏—è–µ—Ç –Ω–∞ –∏—Ç–æ–≥–æ–≤—É—é –ø—Ä–µ–º–∏—é&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",
                type: "efficiency"
            }
        };

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π
        const BANK_REWARDS_CONFIG = {
            consumer_credit: {
                name: "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π –∫—Ä–µ–¥–∏—Ç",
                rate: 1800,
                unit: "‚ÇΩ"
            },
            money_everywhere: {
                name: "\"–î–µ–Ω—å–≥–∏ –≤ –≤—Å–µ–º\"",
                rate: 1800,
                unit: "‚ÇΩ"
            },
            credit_card: {
                name: "–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞",
                rate: 450,
                unit: "‚ÇΩ"
            },
            debit_card_activation: {
                name: "–ö–∞—Ä—Ç–∞ –∫ —Å–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω–æ–º—É –¥–µ–±–µ—Ç–æ–≤–æ–º—É —Å—á–µ—Ç—É —Å –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π",
                rate: 255,
                unit: "‚ÇΩ"
            },
            deposit: {
                name: "–í–∫–ª–∞–¥ (—Å 01.04.2025 –≥. –ø–æ 30.09.2025 –≥., –¥–∞–ª–µ–µ 0 —Ä—É–±.)",
                rate: 50,
                unit: "‚ÇΩ"
            },
            first_sale: {
                name: "–ü–µ—Ä–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞ (–í—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –µ–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–æ)",
                rate: 500,
                unit: "‚ÇΩ"
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞...');
            initializePositionSelector();
            updateInterface();
            console.log('üéØ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...');
            addAutoCalculateListeners();
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ - –∑–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ –ª—é–±–æ–º—É –∫–ª–∏–∫—É
            document.addEventListener('click', function(event) {
                console.log('üñ±Ô∏è –ö–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É:', event.target.tagName, event.target.id, event.target.className);
                
                // –ï—Å–ª–∏ –∫–ª–∏–∫ –ø–æ input –∏–ª–∏ select - –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å—á–µ—Ç —á–µ—Ä–µ–∑ 200ms
                if (event.target.matches('input, select')) {
                    setTimeout(() => {
                        console.log('üéØ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞...');
                        autoCalculate();
                    }, 200);
                }
            });
        });

        function initializePositionSelector() {
            const positionInputs = document.querySelectorAll('input[name="position"]');
            positionInputs.forEach(input => {
                input.addEventListener('change', function() {
                    document.querySelectorAll('.position-option').forEach(option => {
                        option.classList.remove('active');
                    });
                    this.parentElement.classList.add('active');
                    updateInterface();
                });
            });
        }

        function updateInterface() {
            const selectedPosition = document.querySelector('input[name="position"]:checked').value;
            const config = POSITIONS_CONFIG[selectedPosition];
            
            updateOperationsGrid(config.operations);
            updateKPIGrid(config.kpi);
            updateTeamCoefficientsGrid(config.teamCoefficients || []);
            updateBankRewardsGrid(config.hasBankRewards || false);
            updateManagementFields(selectedPosition);
            
            // –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            setTimeout(() => {
                console.log('üîß –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...');
                addAutoCalculateListeners();
            }, 100);
        }

        function updateOperationsGrid(allowedOperations) {
            const grid = document.getElementById('operationsGrid');
            grid.innerHTML = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
            allowedOperations.forEach(operationId => {
                const operation = OPERATIONS_CONFIG[operationId];
                
                const item = document.createElement('div');
                item.className = 'operation-item';
                
                // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ 13 (–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ü–í–ó WB)
                if (operationId === 13) {
                    item.innerHTML = `
                        <div class="operation-label">${operation.name}</div>
                        <div class="operation-rate">${operation.rate}</div>
                        <div class="pvz-wb-params">
                            <input type="number" 
                                   class="operation-input" 
                                   id="op_${operationId}"
                                   placeholder="–ó–∞–∫–∞–∑–æ–≤ –≤ –¥–µ–Ω—å"
                                   min="0"
                                   step="1">
                            <select class="operation-input" id="op_${operationId}_mode">
                                <option value="none">–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–µ–∂–∏–º–∞–º</option>
                                <option value="mode1" selected>–ü–ª–∞–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º ‚Ññ1</option>
                                <option value="mode2">–ü–ª–∞–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º ‚Ññ2</option>
                            </select>
                            <select class="operation-input" id="op_${operationId}_rating">
                                <option value="bad">–†–µ–π—Ç–∏–Ω–≥ < 4.9</option>
                                <option value="good">–†–µ–π—Ç–∏–Ω–≥ 4.9-4.99</option>
                                <option value="excellent" selected>–†–µ–π—Ç–∏–Ω–≥ = 5.0</option>
                            </select>
                        </div>
                    `;
                } else {
                    // –û–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
                    item.innerHTML = `
                        <div class="operation-label">${operation.name}</div>
                        <div class="operation-rate">${operation.rate}</div>
                        <input type="number" 
                               class="operation-input" 
                               id="op_${operationId}"
                               placeholder="${operation.unit}"
                               min="0"
                               step="${operation.type === 'fixed' ? '1' : '0.01'}">
                    `;
                }
                grid.appendChild(item);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–∞—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è
            if (allowedOperations.length > 0) {
                const infoDiv = document.createElement('div');
                infoDiv.className = 'operation-info';
                infoDiv.style.cssText = 'margin-top: 15px; padding: 10px; background: #f0f8ff; border-radius: 8px; font-size: 0.9rem; color: #666;';
                
                const types = [...new Set(allowedOperations.map(id => OPERATIONS_CONFIG[id].operationType))].sort();
                const typeNames = {
                    1: '–¢–∏–ø 1 (–±–µ–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤)',
                    2: '–¢–∏–ø 2 (√óK –°–µ—Ä–≤–∏—Å CSI)',
                    3: '–¢–∏–ø 3 (√óK –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏–µ–º–∞)',
                    4: '–¢–∏–ø 4 (√óK –°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä—É—á–µ–Ω–∏—è)'
                };
                
                infoDiv.innerHTML = `
                    <strong>üí° –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π:</strong><br>
                    ${types.map(type => `‚Ä¢ ${typeNames[type]}`).join('<br>')}
                `;
                grid.appendChild(infoDiv);
            } else {
                // –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ –ù–û–ü–° –±–µ–∑ –æ–ø–µ—Ä–∞—Ü–∏–π
                const infoDiv = document.createElement('div');
                infoDiv.className = 'operation-info';
                infoDiv.style.cssText = 'margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 0.9rem; color: #856404;';
                
                infoDiv.innerHTML = `
                    <strong>üë®‚Äçüíº –ù–û–ü–° —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏:</strong><br>
                    ‚Ä¢ –ù–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–∏—á–Ω–æ<br>
                    ‚Ä¢ –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–º–∏—é –∑–∞ –ö–ü–ò<br>
                    ‚Ä¢ –ü–æ–ª—É—á–∞–µ—Ç 3% –æ—Ç –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö<br>
                    ‚Ä¢ –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø—Ä–µ–º–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å–ø—Ä–∞–≤–∞
                `;
                grid.appendChild(infoDiv);
            }
        }

        function updateKPIGrid(allowedKPI) {
            const grid = document.getElementById('kpiGrid');
            const kpiSection = document.getElementById('kpiSection');
            
            grid.innerHTML = ''; // –û—á–∏—â–∞–µ–º grid –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫ –ö–ü–ò –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –¥–ª—è –¥–∞–Ω–Ω–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
            if (allowedKPI.length === 0) {
                kpiSection.style.display = 'none';
                return;
            } else {
                kpiSection.style.display = 'block';
            }

            // 1. –ü–æ–ª–µ –æ–∫–ª–∞–¥–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) - –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –≤ –ø–æ–ª–æ–≤–∏–Ω—É —à–∏—Ä–∏–Ω—ã
            const salaryItem = document.createElement('div');
            salaryItem.className = 'kpi-item salary-field';
            salaryItem.style.cssText = 'grid-column: 1 / 2; margin-bottom: 15px;';
            salaryItem.innerHTML = `
                <div class="kpi-label">üí∞ –†–∞–∑–º–µ—Ä –æ–∫–ª–∞–¥–∞</div>
                <input type="number" class="kpi-input" id="base_salary" 
                       placeholder="–û–∫–ª–∞–¥ –≤ —Ä—É–±–ª—è—Ö" 
                       min="1" step="100" required>
                <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                    –†–∞–∑–º–µ—Ä –æ–∫–ª–∞–¥–∞ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É
                </div>
            `;
            grid.appendChild(salaryItem);

            // 2. –ü–æ–ª–µ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–∞–≤–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) - –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –≤ –ø–æ–ª–æ–≤–∏–Ω—É —à–∏—Ä–∏–Ω—ã
            const positionItem = document.createElement('div');
            positionItem.className = 'kpi-item position-field';
            positionItem.style.cssText = 'grid-column: 2 / 3; margin-bottom: 15px;';
            positionItem.innerHTML = `
                <div class="kpi-label">üìä –†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏</div>
                <select class="kpi-input" id="position_rate" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É</option>
                    <option value="0.3">0.3 —Å—Ç–∞–≤–∫–∏</option>
                    <option value="0.4">0.4 —Å—Ç–∞–≤–∫–∏</option>
                    <option value="0.5">0.5 —Å—Ç–∞–≤–∫–∏ (–ø–æ–ª—Å—Ç–∞–≤–∫–∏)</option>
                    <option value="0.6">0.6 —Å—Ç–∞–≤–∫–∏</option>
                    <option value="0.7">0.7 —Å—Ç–∞–≤–∫–∏</option>
                    <option value="0.8">0.8 —Å—Ç–∞–≤–∫–∏</option>
                    <option value="0.9">0.9 —Å—Ç–∞–≤–∫–∏</option>
                    <option value="1.0">1.0 —Å—Ç–∞–≤–∫–∏ (–ø–æ–ª–Ω–∞—è —Å—Ç–∞–≤–∫–∞)</option>
                    <option value="1.1">1.1 —Å—Ç–∞–≤–∫–∏</option>
                    <option value="1.2">1.2 —Å—Ç–∞–≤–∫–∏</option>
                    <option value="1.3">1.3 —Å—Ç–∞–≤–∫–∏</option>
                </select>
                <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                    –†–∞–∑–º–µ—Ä —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
                </div>
            `;
            grid.appendChild(positionItem);

            // 3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ —Å —Ñ–æ—Ä–º—É–ª–æ–π
            const infoItem = document.createElement('div');
                            infoItem.style.cssText = 'grid-column: 1 / -1; background: #f8f9fa; border: 1px solid #e2e8f0; padding: 10px; border-radius: 8px; margin-bottom: 15px;';
            infoItem.innerHTML = `
                <div style="font-size: 0.9rem; color: #1976d2; font-weight: 600;">
                                                    üí° –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –ö–ü–ò —Å —É—á–µ—Ç–æ–º –≤–µ—Å–æ–≤ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
                </div>
            `;
            grid.appendChild(infoItem);

            // 4. –û–±—ã—á–Ω—ã–µ –ö–ü–ò –ø–æ–ª—è
            allowedKPI.forEach(kpiId => {
                const kpi = KPI_CONFIG[kpiId];
                
                const item = document.createElement('div');
                item.className = 'kpi-item';
                item.innerHTML = `
                    <div class="kpi-label">${kpi.name}</div>
                    ${kpi.description ? `<div class="operation-rate">${kpi.description}</div>` : ''}
                    <div class="kpi-inputs">
                        <input type="number" class="kpi-input" id="kpi_${kpiId}" placeholder="${kpi.placeholder}" min="0" step="0.1">
                    </div>
                `;
                grid.appendChild(item);
            });

            // 5. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
            addRequiredFieldsValidation();
        }

        function updateTeamCoefficientsGrid(allowedCoefficients) {
            const grid = document.getElementById('coefficientsGrid');
            const coefficientsSection = document.getElementById('coefficientsSection');
            
            grid.innerHTML = ''; // –û—á–∏—â–∞–µ–º grid –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            
            // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º service –∏ efficiency –≤ –ø–µ—Ä–≤—ã–π —Ä—è–¥
            const firstRowCoeffs = ['service', 'efficiency'];
            const secondRowCoeffs = ['speed_reception', 'speed_delivery'];
            
            // –ü–µ—Ä–≤—ã–π —Ä—è–¥: service –∏ efficiency
            firstRowCoeffs.forEach(coeffId => {
                if (allowedCoefficients.includes(coeffId)) {
                    const coeff = TEAM_COEFFICIENTS_CONFIG[coeffId];
                    
                    const item = document.createElement('div');
                    item.className = 'kpi-item';
                    item.innerHTML = `
                        <div class="kpi-label">${coeff.name}</div>
                        ${coeff.description ? `<div class="operation-rate">${coeff.description}</div>` : ''}
                        <div class="kpi-inputs">
                            <input type="number" class="kpi-input" id="coeff_${coeffId}" placeholder="${coeff.placeholder}" min="0" step="0.1">
                        </div>
                    `;
                    grid.appendChild(item);
                }
            });
            
            // –í—Ç–æ—Ä–æ–π —Ä—è–¥: speed_reception –∏ speed_delivery –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            secondRowCoeffs.forEach(coeffId => {
                if (allowedCoefficients.includes(coeffId)) {
                    const coeff = TEAM_COEFFICIENTS_CONFIG[coeffId];
                    
                    const item = document.createElement('div');
                    item.className = 'kpi-item';
                    
                    let optionsHtml = '';
                    let description = '';
                    
                    if (coeffId === 'speed_reception') {
                        description = '–í–ª–∏—è–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ 3.<br>–ù–æ—Ä–º–∞: < 4 –º–∏–Ω = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, > 4 –º–∏–Ω = –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ';
                        optionsHtml = `
                            <option value="1.0">–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ</option>
                            <option value="1.5">–í—ã–ø–æ–ª–Ω–µ–Ω–æ (< 4 –º–∏–Ω)</option>
                            <option value="0.5">–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (> 4 –º–∏–Ω)</option>
                        `;
                    } else if (coeffId === 'speed_delivery') {
                        description = '–í–ª–∏—è–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ 4.<br>–ù–æ—Ä–º–∞: < 1:30 –º–∏–Ω = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, > 1:30 –º–∏–Ω = –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ';
                        optionsHtml = `
                            <option value="1.0">–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ</option>
                            <option value="1.5">–í—ã–ø–æ–ª–Ω–µ–Ω–æ (< 1:30 –º–∏–Ω)</option>
                            <option value="0.5">–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (> 1:30 –º–∏–Ω)</option>
                        `;
                    }
                    
                    item.innerHTML = `
                        <div class="kpi-label">${coeff.name}</div>
                        <div class="operation-rate">${description}</div>
                        <div class="kpi-inputs">
                            <select class="kpi-input" id="coeff_${coeffId}">
                                ${optionsHtml}
                            </select>
                        </div>
                    `;
                    grid.appendChild(item);
                }
            });
        }

        function updateBankRewardsGrid(hasBankRewards) {
            const bankSection = document.getElementById('bankRewardsSection');
            const grid = document.getElementById('bankRewardsGrid');
            
            if (!hasBankRewards) {
                bankSection.style.display = 'none';
                return;
            }
            
            bankSection.style.display = 'block';
            grid.innerHTML = '';
            
            Object.keys(BANK_REWARDS_CONFIG).forEach(rewardId => {
                const reward = BANK_REWARDS_CONFIG[rewardId];
                
                const item = document.createElement('div');
                item.className = 'kpi-item';
                item.innerHTML = `
                    <div class="kpi-label">${reward.name}</div>
                    <div class="operation-rate">${reward.rate} ${reward.unit}</div>
                    <input type="number" 
                           class="kpi-input" 
                           id="bank_${rewardId}"
                           placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"
                           min="0"
                           step="1">
                `;
                grid.appendChild(item);
            });
        }

        function updateManagementFields(selectedPosition) {
            const grid = document.getElementById('coefficientsGrid');
            const coefficientsSection = document.getElementById('coefficientsSection');
            const coefficientsTitle = document.getElementById('coefficientsTitle');
            const config = POSITIONS_CONFIG[selectedPosition];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –¥–ª—è —Å—É–º–º—ã –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ –ù–û–ü–°
            if (config.isManagementOnly) {
                const item = document.createElement('div');
                item.className = 'kpi-item';
                item.innerHTML = `
                    <div class="kpi-label">üí∞ –°—É–º–º–∞ –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö</div>
                    <div class="operation-rate">3% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö</div>
                    <div class="kpi-inputs">
                        <input type="number" class="kpi-input" id="subordinates_bonus" placeholder="–û–±—â–∞—è —Å—É–º–º–∞ ‚ÇΩ" min="0" step="0.01">
                    </div>
                `;
                grid.appendChild(item);
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –Ω–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤, –Ω–∏ –ø–æ–ª—è –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö
            const hasCoefficients = config.teamCoefficients && config.teamCoefficients.length > 0;
            const hasManagementFields = config.isManagementOnly;
            
            if (!hasCoefficients && !hasManagementFields) {
                coefficientsSection.style.display = 'none';
            } else {
                coefficientsSection.style.display = 'block';
                
                // –ò–∑–º–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ NOP–° –µ—Å–ª–∏ –Ω–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
                if (hasManagementFields && !hasCoefficients) {
                    coefficientsTitle.textContent = 'üë• –ö–æ–º–∞–Ω–¥–Ω—ã–π –±–æ–Ω—É—Å';
                } else {
                    coefficientsTitle.textContent = '‚öôÔ∏è –ö–æ–º–∞–Ω–¥–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã';
                }
            }
        }

        function calculateKPICoefficient(percent, type) {
            if (type === 'revenue') {
                if (percent < 80) return 0;
                if (percent < 90) return 0.3;
                if (percent < 100) return 0.5;
                if (percent < 150) return percent / 100;
                return 1.5;
            } else {
                if (percent < 100) return 0;
                if (percent === 100) return 1;
                return Math.min(percent / 100, 1.2);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –±–æ–Ω—É—Å–∞ –¥–ª—è –ü–í–ó WB (–æ–ø–µ—Ä–∞—Ü–∏—è 13) —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ
        function calculatePVZWBBonus(averageOrdersPerDay, mode, rating) {
            // –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: 
            // - averageOrdersPerDay: —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–¥–∞–Ω–Ω—ã—Ö –≤ –ü–í–ó WB –∑–∞–∫–∞–∑–æ–≤ –≤ –¥–µ–Ω—å
            // - mode: —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (none, mode1, mode2)
            // - rating: —Ä–µ–π—Ç–∏–Ω–≥ –ü–í–ó (bad, good, excellent)
            // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –æ–±—â—É—é —Å—É–º–º—É –±–æ–Ω—É—Å–∞ (WB1 + WB2)
            
            let wb1 = 0; // –ß–∞—Å—Ç—å –∑–∞ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –ü–í–ó WB
            let wb2 = 0; // –ß–∞—Å—Ç—å –∑–∞ —Ä–µ–π—Ç–∏–Ω–≥ –ü–í–ó WB
            
            // –†–∞—Å—á–µ—Ç WB1 (—Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã) - —Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
            if (mode === 'none') {
                wb1 = 0; // –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–ª–∞–Ω–æ–≤—ã–º —Ä–µ–∂–∏–º–∞–º
            } else if (mode === 'mode1') {
                // –ü–ª–∞–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º ‚Ññ1: 7 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é, –ø–æ 11 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å
                if (averageOrdersPerDay <= 50) {
                    wb1 = 0;
                } else if (averageOrdersPerDay <= 100) {
                    wb1 = 1000;
                } else if (averageOrdersPerDay <= 166) {
                    wb1 = 2000;
                } else {
                    wb1 = 3000;
                }
            } else if (mode === 'mode2') {
                // –ü–ª–∞–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º ‚Ññ2: –Ω–µ –º–µ–Ω–µ–µ 5 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é, –ø–æ 6 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å
                if (averageOrdersPerDay <= 50) {
                    wb1 = 0;
                } else if (averageOrdersPerDay <= 100) {
                    wb1 = 500;
                } else if (averageOrdersPerDay <= 166) {
                    wb1 = 1000;
                } else {
                    wb1 = 1500;
                }
            }
            
            // –†–∞—Å—á–µ—Ç WB2 (—Ä–µ–π—Ç–∏–Ω–≥) - —Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
            if (rating === 'bad') {
                wb2 = 0; // –†–µ–π—Ç–∏–Ω–≥ < 4.9 –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            } else if (rating === 'good') {
                // –†–µ–π—Ç–∏–Ω–≥ 4.9 ‚â§ –†–µ–π—Ç–∏–Ω–≥ –ü–í–ó WB < 5.0
                if (averageOrdersPerDay <= 50) {
                    wb2 = 0;
                } else if (averageOrdersPerDay <= 100) {
                    wb2 = 1000;
                } else if (averageOrdersPerDay <= 166) {
                    wb2 = 2000;
                } else {
                    wb2 = 3000;
                }
            } else if (rating === 'excellent') {
                // –†–µ–π—Ç–∏–Ω–≥ –ü–í–ó WB = 5.0
                if (averageOrdersPerDay <= 50) {
                    wb2 = 0;
                } else if (averageOrdersPerDay <= 100) {
                    wb2 = 1500;
                } else if (averageOrdersPerDay <= 166) {
                    wb2 = 3000;
                } else {
                    wb2 = 4500;
                }
            }
            
            return wb1 + wb2; // –û–±—â–∏–π –±–æ–Ω—É—Å
        }

        function calculateTeamCoefficient(value, type) {
            if (type === 'service') {
                // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–µ—Ä–≤–∏—Å (CSI) - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Ç–∏–ø–∞ 2
                if (value === 0) return 1.0; // –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω CSI, –±–∞–∑–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
                if (value < 90) return 0.5;
                if (value < 95) return 1.0;
                return 1.5; // CSI >= 95 –±–∞–ª–ª–æ–≤
            } else if (type === 'speed_reception') {
                // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏–µ–º–∞ - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Ç–∏–ø–∞ 3
                // –ù–æ—Ä–º–∞: < 4 –º–∏–Ω = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (1.5), > 4 –º–∏–Ω = –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (0.5)
                if (value === 0) return 1.0; // –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤—Ä–µ–º—è, –±–∞–∑–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
                if (value < 4) return 1.5; // –ú–µ–Ω—å—à–µ 4 –º–∏–Ω—É—Ç - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                return 0.5; // –ë–æ–ª—å—à–µ 4 –º–∏–Ω—É—Ç - –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
            } else if (type === 'speed_delivery') {
                // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä—É—á–µ–Ω–∏—è - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Ç–∏–ø–∞ 4
                // –ù–æ—Ä–º–∞: < 1:30 –º–∏–Ω (1.5 –º–∏–Ω) = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (1.5), > 1:30 –º–∏–Ω = –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (0.5)
                if (value === 0) return 1.0; // –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤—Ä–µ–º—è, –±–∞–∑–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
                if (value < 1.5) return 1.5; // –ú–µ–Ω—å—à–µ 1:30 –º–∏–Ω—É—Ç - –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                return 0.5; // –ë–æ–ª—å—à–µ 1:30 –º–∏–Ω—É—Ç - –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
            } else if (type === 'efficiency') {
                // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –û–ü–° - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∏—Ç–æ–≥–æ–≤–æ–π –ø—Ä–µ–º–∏–∏
                if (value === 0) return 1.0; // –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –ø—Ä–æ—Ü–µ–Ω—Ç –≤—ã—Ä—É—á–∫–∏, –±–∞–∑–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
                if (value >= 100) return 1.3; // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ >= 100%
                return 1.0; // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ < 100%
            }
            return 1.0; // –ë–∞–∑–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
        }

        function addRequiredFieldsValidation() {
            const salaryInput = document.getElementById('base_salary');
            const positionInput = document.getElementById('position_rate');
            
            function validateField(input, parentClass) {
                const value = input.type === 'select-one' ? 
                    parseFloat(input.value) || 0 : 
                    parseFloat(input.value) || 0;
                    
                const parentDiv = input.closest('.' + parentClass);
                
                if (value <= 0) {
                    parentDiv.classList.add('error');
                } else {
                    parentDiv.classList.remove('error');
                }
            }
            
            if (salaryInput) {
                salaryInput.addEventListener('input', () => 
                    validateField(salaryInput, 'salary-field'));
            }
            
            if (positionInput) {
                positionInput.addEventListener('change', () => 
                    validateField(positionInput, 'position-field'));
            }
        }

        function calculatePremium() {
            const selectedPosition = document.querySelector('input[name="position"]:checked').value;
            const config = POSITIONS_CONFIG[selectedPosition];
            
            // –†–∞—Å—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏ –ø–æ —Ç–∏–ø–∞–º
            let operationsBonus = 0;
            const operationsDetails = [];
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
            let serviceCoeff = 1.0;
            let speedReceptionCoeff = 1.0;
            let speedDeliveryCoeff = 1.0;
            let efficiencyCoeff = 1.0;
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
            if (config.teamCoefficients) {
                config.teamCoefficients.forEach(coeffId => {
                    const input = document.getElementById(`coeff_${coeffId}`);
                    if (!input) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
                    
                    let coefficient;
                    
                    if (coeffId === 'service') {
                        // CSI –≤ –±–∞–ª–ª–∞—Ö, –±–µ–∑ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
                        const value = parseFloat(input.value) || 0;
                        coefficient = calculateTeamCoefficient(value, 'service');
                        serviceCoeff = coefficient;
                    } else if (coeffId === 'speed_reception') {
                        // –ü—Ä—è–º–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∏–∑ select
                        coefficient = parseFloat(input.value) || 1.0;
                        speedReceptionCoeff = coefficient;
                    } else if (coeffId === 'speed_delivery') {
                        // –ü—Ä—è–º–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∏–∑ select
                        coefficient = parseFloat(input.value) || 1.0;
                        speedDeliveryCoeff = coefficient;
                    } else if (coeffId === 'efficiency') {
                        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
                        const value = parseFloat(input.value) || 0;
                        coefficient = calculateTeamCoefficient(value, 'efficiency');
                        efficiencyCoeff = coefficient;
                    }
                });
            }
            
            config.operations.forEach(operationId => {
                const input = document.getElementById(`op_${operationId}`);
                if (!input) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
                const value = parseFloat(input.value) || 0;
                
                if (value > 0) {
                    const operation = OPERATIONS_CONFIG[operationId];
                    let operationValue = operation.value;
                    
                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ 25 (—É—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö) - —Ä–∞–∑–Ω—ã–µ —Å—Ç–∞–≤–∫–∏
                    if (operationId === 25) {
                        if (selectedPosition === 'postman') {
                            operationValue = 13; // 13‚ÇΩ –¥–ª—è –ø–æ—á—Ç–∞–ª—å–æ–Ω–∞
                        } else {
                            operationValue = 10; // 10‚ÇΩ –¥–ª—è –ù–û–ü–° –∏ –¥—Ä—É–≥–∏—Ö
                        }
                    }
                    
                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ 13 (–ü–í–ó WB) - —Ä–∞—Å—á–µ—Ç –ø–æ —Ç–∞–±–ª–∏—Ü–µ
                    if (operationId === 13) {
                        const modeSelect = document.getElementById(`op_${operationId}_mode`);
                        const ratingSelect = document.getElementById(`op_${operationId}_rating`);
                        const mode = modeSelect ? modeSelect.value : 'mode1';
                        const rating = ratingSelect ? ratingSelect.value : 'excellent';
                        operationValue = calculatePVZWBBonus(value, mode, rating); // –†–∞—Å—á–µ—Ç –ø–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
                    }
                    
                    let bonus;
                    if (operation.type === 'percent') {
                        bonus = value * operationValue;
                    } else if (operation.type === 'formula') {
                        bonus = operationValue; // –î–ª—è —Ñ–æ—Ä–º—É–ª operationValue —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
                    } else {
                        bonus = value * operationValue;
                    }
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏
                    let appliedCoeff = 1.0;
                    let coeffType = '';
                    
                    if (operation.operationType === 1) {
                        // –¢–∏–ø 1 - –±–µ–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
                        appliedCoeff = 1.0;
                        coeffType = '–ë–µ–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤';
                    } else if (operation.operationType === 2) {
                        // –¢–∏–ø 2 - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–µ—Ä–≤–∏—Å (CSI)
                        appliedCoeff = serviceCoeff;
                        coeffType = `CSI (√ó${appliedCoeff.toFixed(1)})`;
                    } else if (operation.operationType === 3) {
                        // –¢–∏–ø 3 - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏–µ–º–∞
                        appliedCoeff = speedReceptionCoeff;
                        coeffType = `–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏–µ–º–∞ (√ó${appliedCoeff.toFixed(1)})`;
                    } else if (operation.operationType === 4) {
                        // –¢–∏–ø 4 - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä—É—á–µ–Ω–∏—è
                        appliedCoeff = speedDeliveryCoeff;
                        coeffType = `–°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä—É—á–µ–Ω–∏—è (√ó${appliedCoeff.toFixed(1)})`;
                    }
                    
                    const finalBonus = bonus * appliedCoeff;
                    operationsBonus += finalBonus;
                    
                    operationsDetails.push({
                        name: operation.name,
                        value: value,
                        unit: operation.unit,
                        bonus: finalBonus,
                        baseBonus: bonus,
                        coefficient: appliedCoeff,
                        coeffType: coeffType
                    });
                }
            });

            // –†–∞—Å—á–µ—Ç –ö–ü–ò
            let kpiBonus = 0;
            let revenuePercent = 100;
            const kpiDetails = [];
            let warningShown = false;

            // –î–ª—è –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π —Å –ö–ü–ò - –ø—Ä–æ–≤–µ—Ä—è–µ–º –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ø–æ–ª—è
            if (config.kpi && config.kpi.length > 0) {
                const baseSalaryInput = document.getElementById('base_salary');
                const positionRateInput = document.getElementById('position_rate');
                
                const baseSalary = parseFloat(baseSalaryInput?.value) || 0;
                const positionRate = parseFloat(positionRateInput?.value) || 0;
                
                let hasErrors = false;
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–∫–ª–∞–¥–∞
                if (baseSalaryInput && baseSalary <= 0) {
                    baseSalaryInput.style.borderColor = '#ff4757';
                    baseSalaryInput.style.backgroundColor = '#ffe6e6';
                    hasErrors = true;
                } else if (baseSalaryInput) {
                    baseSalaryInput.style.borderColor = '';
                    baseSalaryInput.style.backgroundColor = '';
                }
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–∞–≤–∫–∏
                if (positionRateInput && positionRate <= 0) {
                    positionRateInput.style.borderColor = '#ff4757';
                    positionRateInput.style.backgroundColor = '#ffe6e6';
                    hasErrors = true;
                } else if (positionRateInput) {
                    positionRateInput.style.borderColor = '';
                    positionRateInput.style.backgroundColor = '';
                }
                
                if (hasErrors) {
                    // –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert –∏ –Ω–µ —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è
                    return;
                }
                
                // –®–ê–ì 1: –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–∫–ª–∞–¥–∞ —Å —É—á–µ—Ç–æ–º —Å—Ç–∞–≤–∫–∏
                const realSalary = baseSalary * positionRate;
                
                // –®–ê–ì 2: –ë–∞–∑–æ–≤–∞—è —Å—É–º–º–∞ –ö–ü–ò = 20% –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–∫–ª–∞–¥–∞
                const baseKPIAmount = realSalary * 0.20;
                
                // –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
                const positionWeights = KPI_WEIGHTS[selectedPosition] || {};
                
                config.kpi.forEach(kpiId => {
                    const input = document.getElementById(`kpi_${kpiId}`);
                    if (!input) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
                    const value = parseFloat(input.value) || 0;
                    
                    if (value > 0) {
                        const percent = value;
                        let coefficient = calculateKPICoefficient(percent, kpiId);
                        
                        if (kpiId === 'revenue') {
                            revenuePercent = percent;
                            if (percent < 80) {
                                const warningElement = document.getElementById('warningCritical');
                                if (warningElement) {
                                    warningElement.style.display = 'block';
                                }
                                warningShown = true;
                            }
                        }
                        
                        // –®–ê–ì 3: –ü–†–ê–í–ò–õ–¨–ù–ê–Ø —Ñ–æ—Ä–º—É–ª–∞ –ö–ü–ò —Å –≤–µ—Å–∞–º–∏
                        const weight = positionWeights[kpiId] || 0;
                        const bonus = baseKPIAmount * weight * coefficient;
                        kpiBonus += bonus;
                        
                        kpiDetails.push({
                            name: KPI_CONFIG[kpiId].name,
                            percent: percent.toFixed(1),
                            coefficient: coefficient,
                            weight: weight,
                            bonus: bonus,
                            baseSalary: baseSalary,
                            positionRate: positionRate,
                            realSalary: realSalary,
                            baseKPIAmount: baseKPIAmount
                        });
                    }
                });
            }

            if (!warningShown) {
                const warningElement = document.getElementById('warningCritical');
                if (warningElement) {
                    warningElement.style.display = 'none';
                }
            }

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ 80% (—Ç–æ–ª—å–∫–æ –¥–ª—è –ö–ü–ò, –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è)
            if (revenuePercent < 80) {
                kpiBonus = 0;
                kpiDetails.forEach(detail => {
                    detail.bonus = 0;
                    detail.coefficient = 0;
                });
            }

            // –ö–æ–º–∞–Ω–¥–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
            const coefficientsDetails = [];

            if (config.teamCoefficients) {
                config.teamCoefficients.forEach(coeffId => {
                    const input = document.getElementById(`coeff_${coeffId}`);
                    let coefficient;
                    let shouldDisplay = false;
                    
                    if (coeffId === 'service') {
                        const value = parseFloat(input.value) || 0;
                        coefficient = calculateTeamCoefficient(value, 'service');
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ò –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –Ω–µ –±–∞–∑–æ–≤—ã–π
                        shouldDisplay = value > 0 && coefficient !== 1.0;
                        if (shouldDisplay) {
                            coefficientsDetails.push({
                                name: TEAM_COEFFICIENTS_CONFIG[coeffId].name,
                                value: value,
                                coefficient: coefficient
                            });
                        }
                    } else if (coeffId === 'speed_reception') {
                        const selectValue = input.value;
                        coefficient = parseFloat(selectValue) || 1.0;
                        // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ "–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ" (1.0)
                        if (selectValue !== "1.0") {
                            const displayValue = selectValue === "1.5" ? "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" : 
                                                selectValue === "0.5" ? "–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ" : selectValue;
                            coefficientsDetails.push({
                                name: TEAM_COEFFICIENTS_CONFIG[coeffId].name,
                                value: displayValue,
                                coefficient: coefficient
                            });
                        }
                    } else if (coeffId === 'speed_delivery') {
                        const selectValue = input.value;
                        coefficient = parseFloat(selectValue) || 1.0;
                        // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ "–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ" (1.0)
                        if (selectValue !== "1.0") {
                            const displayValue = selectValue === "1.5" ? "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" : 
                                                selectValue === "0.5" ? "–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ" : selectValue;
                            coefficientsDetails.push({
                                name: TEAM_COEFFICIENTS_CONFIG[coeffId].name,
                                value: displayValue,
                                coefficient: coefficient
                            });
                        }
                    } else if (coeffId === 'efficiency') {
                        const value = parseFloat(input.value) || 0;
                        coefficient = calculateTeamCoefficient(value, 'efficiency');
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ò –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –Ω–µ –±–∞–∑–æ–≤—ã–π
                        shouldDisplay = value > 0 && coefficient !== 1.0;
                        if (shouldDisplay) {
                            coefficientsDetails.push({
                                name: TEAM_COEFFICIENTS_CONFIG[coeffId].name,
                                value: value,
                                coefficient: coefficient
                            });
                        }
                    }
                });
            }

            // –û–ø–µ—Ä–∞—Ü–∏–∏ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏
            const adjustedOperationsBonus = operationsBonus;

            // –ö–æ–º–∞–Ω–¥–Ω—ã–π –±–æ–Ω—É—Å
            let teamBonus = 0;
            if (config.hasTeamBonus) {
                if (config.isManagementOnly) {
                    // –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ –ù–û–ü–° - –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö
                    const subordinatesInput = document.getElementById('subordinates_bonus');
                    const subordinatesBonus = parseFloat(subordinatesInput?.value) || 0;
                    teamBonus = subordinatesBonus * 0.03; // 3% –æ—Ç –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö
                } else {
                    // –î–ª—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ù–û–ü–° - —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç
                    teamBonus = adjustedOperationsBonus * 0.03;
                }
            }

            // –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
            let bankBonus = 0;
            if (config.hasBankRewards) {
                Object.keys(BANK_REWARDS_CONFIG).forEach(rewardId => {
                    const input = document.getElementById(`bank_${rewardId}`);
                    if (input) {
                        const quantity = parseFloat(input.value) || 0;
                        if (quantity > 0) {
                            const reward = BANK_REWARDS_CONFIG[rewardId];
                            bankBonus += quantity * reward.rate;
                        }
                    }
                });
            }

            // –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–µ–º–∏—è —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –û–ü–°
            // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ NOPS –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É (—É –Ω–∏—Ö –µ—Å—Ç—å –ö–ü–ò)
            // –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –ù–ï —É—á–∞—Å—Ç–≤—É—é—Ç –≤ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
            const totalBeforeEfficiency = adjustedOperationsBonus + kpiBonus + teamBonus;
            const hasKPI = config.kpi && config.kpi.length > 0;
            const totalPremium = hasKPI ? (totalBeforeEfficiency + bankBonus) : ((totalBeforeEfficiency * efficiencyCoeff) + bankBonus);

            displayResults({
                operationsBonus: adjustedOperationsBonus,
                operationsDetails,
                kpiBonus,
                kpiDetails,
                teamBonus,
                bankBonus,
                totalPremium,
                position: config.name,
                revenuePercent,
                coefficientsDetails,
                serviceCoeff,
                speedReceptionCoeff,
                speedDeliveryCoeff,
                efficiencyCoeff,
                hasKPI
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        function autoCalculate() {
            console.log('üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∑–∞–ø—É—â–µ–Ω...');
            try {
                calculatePremium();
                console.log('‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
            } catch (error) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∏—Ö –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
                console.log('‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω:', error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –∫–æ –≤—Å–µ–º –ø–æ–ª—è–º –≤–≤–æ–¥–∞
        function addAutoCalculateListeners() {
            console.log('üîó –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–∏–≤—è–∑–∫—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...');
            
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            document.querySelectorAll('.operation-input, .kpi-input').forEach(input => {
                input.removeEventListener('input', autoCalculate);
                input.removeEventListener('change', autoCalculate);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
            const positionInputs = document.querySelectorAll('input[name="position"]');
            console.log('üìã –ù–∞–π–¥–µ–Ω–æ —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏:', positionInputs.length);
            positionInputs.forEach(input => {
                input.removeEventListener('change', autoCalculate);
                input.addEventListener('change', autoCalculate);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –æ–ø–µ—Ä–∞—Ü–∏–π
            const operationInputs = document.querySelectorAll('.operation-input');
            console.log('‚öôÔ∏è –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ–π –æ–ø–µ—Ä–∞—Ü–∏–π:', operationInputs.length);
            operationInputs.forEach(input => {
                input.addEventListener('input', autoCalculate);
                input.addEventListener('change', autoCalculate);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –ö–ü–ò (–≤–∫–ª—é—á–∞—è –æ–∫–ª–∞–¥, —Å—Ç–∞–≤–∫—É –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã)
            const kpiInputs = document.querySelectorAll('.kpi-input');
            console.log('üìä –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ–π –ö–ü–ò:', kpiInputs.length);
            kpiInputs.forEach(input => {
                input.addEventListener('input', autoCalculate);
                input.addEventListener('change', autoCalculate);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è select —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
            const selectInputs = document.querySelectorAll('select.kpi-input');
            console.log('üìù –ù–∞–π–¥–µ–Ω–æ select —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', selectInputs.length);
            selectInputs.forEach(select => {
                select.addEventListener('change', autoCalculate);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ ID
            let foundCoefficients = 0;
            ['coeff_service', 'coeff_speed_reception', 'coeff_speed_delivery', 'coeff_efficiency', 'subordinates_bonus'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    foundCoefficients++;
                    element.removeEventListener('input', autoCalculate);
                    element.removeEventListener('change', autoCalculate);
                    element.addEventListener('input', autoCalculate);
                    element.addEventListener('change', autoCalculate);
                }
            });
            console.log('üéØ –ù–∞–π–¥–µ–Ω–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ ID:', foundCoefficients);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π
            let foundBankRewards = 0;
            Object.keys(BANK_REWARDS_CONFIG).forEach(rewardId => {
                const element = document.getElementById(`bank_${rewardId}`);
                if (element) {
                    foundBankRewards++;
                    element.removeEventListener('input', autoCalculate);
                    element.addEventListener('input', autoCalculate);
                }
            });
            console.log('üè¶ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ–π –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π:', foundBankRewards);

            console.log('‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
            setTimeout(autoCalculate, 100);
        }

        function displayResults(results) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
            updateFixedSummary(results.totalPremium, results.position);
            
            const container = document.getElementById('resultsContent');
            let html = '';
            
            if (results.operationsDetails.length > 0) {
                html += '<div class="result-item"><span>üíº –õ–∏—á–Ω—ã–µ –±–æ–Ω—É—Å—ã:</span><span>' + 
                        formatMoney(results.operationsBonus) + '</span></div>';
                
                results.operationsDetails.forEach(detail => {
                    const coeffDisplay = detail.coefficient !== 1.0 ? ` ‚Ä¢ ${detail.coeffType}` : '';
                    html += '<div class="result-item" style="font-size: 0.9rem; padding: 8px 0;"><span>  ‚Ä¢ ' + 
                            detail.name + ' (' + detail.value + ' ' + detail.unit + ')' + coeffDisplay + ':</span><span>' + 
                            formatMoney(detail.bonus) + '</span></div>';
                });
            }

            if (results.kpiDetails.length > 0) {
                const firstKpi = results.kpiDetails[0];
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑—É —Ä–∞—Å—á–µ—Ç–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–± –æ–∫–ª–∞–¥–µ –∏ —Å—Ç–∞–≤–∫–µ
                if (firstKpi.baseSalary && firstKpi.positionRate) {
                    html += '<div class="result-item"><span>üí∞ –û–∫–ª–∞–¥ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É:</span><span>' + 
                            formatMoney(firstKpi.baseSalary) + '</span></div>';
                            
                    html += '<div class="result-item"><span>üìä –†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏:</span><span>' + 
                            firstKpi.positionRate + ' (' + (firstKpi.positionRate * 100) + '%)</span></div>';
                            
                    html += '<div class="result-item"><span>üíµ –†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–∫–ª–∞–¥–∞:</span><span>' + 
                            formatMoney(firstKpi.realSalary) + '</span></div>';
                            
                    html += '<div class="result-item"><span>üìã –ë–∞–∑–æ–≤–∞—è —Å—É–º–º–∞ –ö–ü–ò (20%):</span><span>' + 
                            formatMoney(firstKpi.baseKPIAmount) + '</span></div>';
                }
                
                html += '<div class="result-item"><span>üìä –ë–æ–Ω—É—Å –∑–∞ –ö–ü–ò:</span><span>' + 
                        formatMoney(results.kpiBonus) + '</span></div>';
                
                results.kpiDetails.forEach(detail => {
                    const weightDisplay = detail.weight ? `, –≤–µ—Å=${(detail.weight*100).toFixed(0)}%` : '';
                    html += '<div class="result-item" style="font-size: 0.9rem; padding: 8px 0;"><span>  ‚Ä¢ ' + 
                            detail.name + ' (' + detail.percent + '%, –∫=' + detail.coefficient.toFixed(2) + weightDisplay + '):</span><span>' + 
                            formatMoney(detail.bonus) + '</span></div>';
                });
            }

            if (results.teamBonus > 0) {
                const bonusLabel = results.position.includes('—Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏') ? 
                    'üë• –ö–æ–º–∞–Ω–¥–Ω—ã–π –±–æ–Ω—É—Å (3% –æ—Ç –ø—Ä–µ–º–∏–π –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã—Ö):' : 
                    'üë• –ö–æ–º–∞–Ω–¥–Ω—ã–π –±–æ–Ω—É—Å –ù–û–ü–° (3%):';
                html += '<div class="result-item"><span>' + bonusLabel + '</span><span>' + 
                        formatMoney(results.teamBonus) + '</span></div>';
            }

            if (results.bankBonus > 0) {
                html += '<div class="result-item"><span>üè¶ –ê–≥–µ–Ω—Ç—Å–∫–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –±–∞–Ω–∫–∞:</span><span>' + 
                        formatMoney(results.bankBonus) + '</span></div>';
            }

            // –ö–æ–º–∞–Ω–¥–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
            if (results.coefficientsDetails && results.coefficientsDetails.length > 0) {
                html += '<div class="result-item"><span>‚öôÔ∏è –ö–æ–º–∞–Ω–¥–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:</span><span></span></div>';
                
                results.coefficientsDetails.forEach(detail => {
                    const valueDisplay = detail.name.includes('CSI') ? 
                        `${detail.value} –±–∞–ª–ª–æ–≤` : 
                        `${detail.value}%`;
                    html += '<div class="result-item" style="font-size: 0.9rem; padding: 8px 0;"><span>  ‚Ä¢ ' + 
                            detail.name + ' (' + valueDisplay + '):</span><span>K = ' + 
                            detail.coefficient.toFixed(1) + '</span></div>';
                });

                // –ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –û–ü–° (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è)
                if (results.efficiencyCoeff !== 1.0 && !results.hasKPI) {
                    html += '<div class="result-item" style="font-size: 0.9rem; padding: 8px 0;"><span>  ‚Ä¢ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –û–ü–°:</span><span>K = ' + 
                            results.efficiencyCoeff.toFixed(1) + '</span></div>';
                }
            }

            html += '<div class="result-item"><span>üèÜ –ò–¢–û–ì–û –ü–†–ï–ú–ò–Ø:</span><span>' + 
                    formatMoney(results.totalPremium) + '</span></div>';

            container.innerHTML = html;
        }

        function formatMoney(amount) {
            // –ï—Å–ª–∏ —á–∏—Å–ª–æ —Ü–µ–ª–æ–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–∑ –¥—Ä–æ–±–Ω–æ–π —á–∞—Å—Ç–∏
            // –ï—Å–ª–∏ –¥—Ä–æ–±–Ω–æ–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –¥–µ—Å—è—Ç–∏—á–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏
            const roundedAmount = Number(amount.toFixed(2));
            return new Intl.NumberFormat('ru-RU', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(roundedAmount) + ' ‚ÇΩ';
        }

        function updateFixedSummary(totalPremium, position) {
            const summaryAmount = document.getElementById('summaryAmount');
            
            summaryAmount.textContent = formatMoney(totalPremium);
        }


    </script>
</body>
</html> 