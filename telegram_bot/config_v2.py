import os
from dotenv import load_dotenv
from dataclasses import dataclass, field
from typing import Dict, List, Optional

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
if not TOKEN:
    raise ValueError("–ù–µ –∑–∞–¥–∞–Ω TELEGRAM_BOT_TOKEN –≤ —Ñ–∞–π–ª–µ .env")

# v2.4: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å HTML –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º –ø—Ä–µ–º–∏–π –û–ü–°
# –¢–æ—á–Ω–∞—è –∫–æ–ø–∏—è POSITIONS_CONFIG –∏–∑ HTML

POSITIONS_CONFIG = {
    "operator": {
        "name": "–û–ø–µ—Ä–∞—Ç–æ—Ä 1-3 –∫–ª–∞—Å—Å–∞",
        "emoji": "üë®‚Äçüíº",
        "operations": [1, 3, 4, 5, 6, 7, 10, 11, 12, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24],
        "kpi": [],  # –£ –æ–±—ã—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ù–ï–¢ –ö–ü–ò
        "teamCoefficients": ["service", "speed_reception", "speed_delivery", "efficiency"],
        "hasTeamBonus": False
    },
    "nops_operational": {
        "name": "–ù–û–ü–° –±–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (—Å–∞–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏)",
        "emoji": "üë®‚Äçüíº",
        "operations": [1, 3, 4, 5, 6, 7, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 22, 23, 24, 25],
        "kpi": ["revenue", "csi", "online_rpo", "co1_co2"],
        "teamCoefficients": [],  # –ö–ü–ò —Å–∏—Å—Ç–µ–º–∞ –≤–º–µ—Å—Ç–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
        "hasTeamBonus": False
    },
    "nops_management": {
        "name": "–ù–û–ü–° —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ (—Ç–æ–ª—å–∫–æ —Ä—É–∫–æ–≤–æ–¥—è—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏)",
        "emoji": "üë®‚Äç‚úàÔ∏è",
        "operations": [10, 11, 12, 13, 14, 25],
        "kpi": ["revenue", "csi", "online_rpo", "co1_co2"],
        "teamCoefficients": [],  # –ö–ü–ò —Å–∏—Å—Ç–µ–º–∞ –≤–º–µ—Å—Ç–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
        "hasTeamBonus": True,
        "isManagementOnly": True
    },
    "admin": {
        "name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
        "emoji": "üë®‚Äçüíª",
        "operations": [3, 11, 16, 19, 20],
        "kpi": ["revenue", "csi", "online_rpo"],
        "teamCoefficients": ["service", "speed_reception", "speed_delivery"],
        "hasTeamBonus": False
    },
    "postman": {
        "name": "–ü–æ—á—Ç–∞–ª—å–æ–Ω",
        "emoji": "üö∂‚Äç‚ôÇÔ∏è",
        "operations": [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 25],
        "kpi": [],  # –£ –ø–æ—á—Ç–∞–ª—å–æ–Ω–∞ –ù–ï–¢ –ö–ü–ò
        "teamCoefficients": ["service", "efficiency"],
        "hasTeamBonus": False
    },
    "chief_specialist": {
        "name": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –ø–æ—á—Ç–æ–≤–æ–π —Å–≤—è–∑–∏",
        "emoji": "üë®‚Äçüî¨",
        "operations": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
        "kpi": [],  # –£ –≥–ª–∞–≤–Ω–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ù–ï–¢ –ö–ü–ò
        "teamCoefficients": ["service", "speed_reception", "speed_delivery", "efficiency"],
        "hasTeamBonus": False
    }
}

# –¢–æ—á–Ω–∞—è –∫–æ–ø–∏—è OPERATIONS_CONFIG –∏–∑ HTML –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
OPERATIONS_CONFIG = {
    1: {"name": "–†–æ–∑–Ω–∏—Ü–∞ (—Ç–æ–≤–∞—Ä—ã)", "rate": "3% –æ—Ç —Å—É–º–º—ã", "type": "percent", "value": 0.03, "unit": "‚ÇΩ", "operationType": 2, "emoji": "üõí", "max_reasonable": 10000, "description": "–ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Ä–æ–∑–Ω–∏—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ"},
    2: {"name": "–†–æ–∑–Ω–∏—Ü–∞ 16 –î–ü", "rate": "5% –æ—Ç —Å—É–º–º—ã", "type": "percent", "value": 0.05, "unit": "‚ÇΩ", "operationType": 2, "emoji": "üè™", "max_reasonable": 5000, "description": "–ü—Ä–æ–¥–∞–∂–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ 16 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º"},
    3: {"name": "–õ–æ—Ç–µ—Ä–µ–π–Ω—ã–µ –±–∏–ª–µ—Ç—ã", "rate": "3% –æ—Ç —Å—É–º–º—ã", "type": "percent", "value": 0.03, "unit": "‚ÇΩ", "operationType": 2, "emoji": "üé≤", "max_reasonable": 3000, "description": "–ü—Ä–æ–¥–∞–∂–∞ –ª–æ—Ç–µ—Ä–µ–π–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∏–¥–æ–≤"},
    4: {"name": "–ü–æ–¥–ø–∏—Å–∫–∞", "rate": "2% –æ—Ç —Å—É–º–º—ã", "type": "percent", "value": 0.02, "unit": "‚ÇΩ", "operationType": 2, "emoji": "üì∞", "max_reasonable": 5000, "description": "–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∏–∑–¥–∞–Ω–∏—è"},
    5: {"name": "–°–∏–º-–∫–∞—Ä—Ç–∞ —Ç–∏–ø 1", "rate": "50‚ÇΩ/—à—Ç", "type": "fixed", "value": 50, "unit": "—à—Ç", "operationType": 2, "emoji": "üì±", "max_reasonable": 20, "description": "–ü—Ä–æ–¥–∞–∂–∞ SIM-–∫–∞—Ä—Ç –ø–µ—Ä–≤–æ–≥–æ —Ç–∏–ø–∞"},
    6: {"name": "–°–∏–º-–∫–∞—Ä—Ç–∞ —Ç–∏–ø 2", "rate": "30‚ÇΩ/—à—Ç", "type": "fixed", "value": 30, "unit": "—à—Ç", "operationType": 2, "emoji": "üì≤", "max_reasonable": 30, "description": "–ü—Ä–æ–¥–∞–∂–∞ SIM-–∫–∞—Ä—Ç –≤—Ç–æ—Ä–æ–≥–æ —Ç–∏–ø–∞"},
    7: {"name": "–°–∏–º-–∫–∞—Ä—Ç–∞ —Ç–∏–ø 3", "rate": "10‚ÇΩ/—à—Ç", "type": "fixed", "value": 10, "unit": "—à—Ç", "operationType": 2, "emoji": "üìû", "max_reasonable": 50, "description": "–ü—Ä–æ–¥–∞–∂–∞ SIM-–∫–∞—Ä—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ —Ç–∏–ø–∞"},
    8: {"name": "–î–æ—Å—Ç–∞–≤–∫–∞ –≥–∏–ø–µ—Ä–ª–æ–∫–∞", "rate": "50‚ÇΩ/—à—Ç", "type": "fixed", "value": 50, "unit": "—à—Ç", "operationType": 2, "emoji": "üîí", "max_reasonable": 20, "description": "–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ—Å—ã–ª–æ–∫ —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —è—á–µ–π–∫–∏"},
    9: {"name": "–ü–ª–∞—Ç–µ–∂ —Å –ú–ü–ö–¢", "rate": "3‚ÇΩ/—à—Ç", "type": "fixed", "value": 3, "unit": "—à—Ç", "operationType": 2, "emoji": "üí≥", "max_reasonable": 100, "description": "–ü—Ä–∏–µ–º –ø–ª–∞—Ç–µ–∂–µ–π —Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø–æ—á—Ç–æ–≤–æ-–∫–∞—Å—Å–æ–≤–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞"},
    10: {"name": "–ú—É–ª—å—Ç–∏–ø–æ–¥–ø–∏—Å—å", "rate": "30‚ÇΩ/—à—Ç", "type": "fixed", "value": 30, "unit": "—à—Ç", "operationType": 2, "emoji": "‚úçÔ∏è", "max_reasonable": 50, "description": "–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏"},
    11: {"name": "–ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä–∞", "rate": "300‚ÇΩ/—á–µ–ª", "type": "fixed", "value": 300, "unit": "—á–µ–ª", "operationType": 1, "emoji": "üë¥", "max_reasonable": 10, "description": "–ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ–Ω—Å–∏–∏ –Ω–∞ –ø–æ—á—Ç–µ"},
    12: {"name": "–í—ã–¥–∞—á–∞ WB", "rate": "5‚ÇΩ/–∑–∞–∫–∞–∑", "type": "fixed", "value": 5, "unit": "–∑–∞–∫–∞–∑", "operationType": 1, "emoji": "üì¶", "max_reasonable": 200, "description": "–í—ã–¥–∞—á–∞ –∑–∞–∫–∞–∑–æ–≤ Wildberries –≤ –û–ü–°"},
    13: {"name": "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ü–í–ó WB", "rate": "–ø–æ —Ç–∞–±–ª–∏—Ü–µ", "type": "formula", "value": 0, "unit": "—É—Å–ª—É–≥–∞", "operationType": 1, "emoji": "üè¢", "max_reasonable": 10, "description": "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ –∑–∞–∫–∞–∑–æ–≤ Wildberries"},
    14: {"name": "–í–æ–∑–≤—Ä–∞—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å2—Å prof", "rate": "1000‚ÇΩ/–∫–ª–∏–µ–Ω—Ç", "type": "fixed", "value": 1000, "unit": "–∫–ª–∏–µ–Ω—Ç", "operationType": 1, "emoji": "üîÑ", "max_reasonable": 5, "description": "–í–æ–∑–≤—Ä–∞—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏"},
    15: {"name": "–ü—Ä–æ–¥–∞–∂–∞ EMS", "rate": "40‚ÇΩ/—É—Å–ª—É–≥–∞", "type": "fixed", "value": 40, "unit": "—É—Å–ª—É–≥–∞", "operationType": 3, "emoji": "üì®", "max_reasonable": 50, "description": "–ü—Ä–æ–¥–∞–∂–∞ —É—Å–ª—É–≥ —ç–∫—Å–ø—Ä–µ—Å—Å-–¥–æ—Å—Ç–∞–≤–∫–∏ EMS"},
    16: {"name": "–ü—Ä–∏–µ–º EMS –ø—Ä–µ–¥–æ–ø–ª–∞—á.", "rate": "50‚ÇΩ/—à—Ç", "type": "fixed", "value": 50, "unit": "—à—Ç", "operationType": 3, "emoji": "üìÆ", "max_reasonable": 30, "description": "–ü—Ä–∏–µ–º –ø—Ä–µ–¥–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π EMS"},
    17: {"name": "–ü—Ä–∏–µ–º –†–ü–û –ø–æ—Å—ã–ª–∫–∞", "rate": "5‚ÇΩ/—à—Ç", "type": "fixed", "value": 5, "unit": "—à—Ç", "operationType": 3, "emoji": "üì¶", "max_reasonable": 100, "description": "–ü—Ä–∏–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—ã—Ö –ø–æ—á—Ç–æ–≤—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π - –ø–æ—Å—ã–ª–∫–∏"},
    18: {"name": "–ü—Ä–∏–µ–º –†–ü–û –ø–∏—Å—å–º–æ", "rate": "0.5‚ÇΩ/—à—Ç", "type": "fixed", "value": 0.5, "unit": "—à—Ç", "operationType": 3, "emoji": "‚úâÔ∏è", "max_reasonable": 200, "description": "–ü—Ä–∏–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—ã—Ö –ø–æ—á—Ç–æ–≤—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π - –ø–∏—Å—å–º–∞"},
    19: {"name": "–ü—Ä–∏–µ–º –ø—Ä–µ–¥–æ–ø–ª–∞—á. –†–ü–û –ø–æ—Å—ã–ª–∫–∞", "rate": "7‚ÇΩ/—à—Ç", "type": "fixed", "value": 7, "unit": "—à—Ç", "operationType": 3, "emoji": "üìÆ", "max_reasonable": 80, "description": "–ü—Ä–∏–µ–º –ø—Ä–µ–¥–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –†–ü–û - –ø–æ—Å—ã–ª–∫–∏"},
    20: {"name": "–ü—Ä–∏–µ–º –ø—Ä–µ–¥–æ–ø–ª–∞—á. –†–ü–û –ø–∏—Å—å–º–æ", "rate": "1‚ÇΩ/—à—Ç", "type": "fixed", "value": 1, "unit": "—à—Ç", "operationType": 3, "emoji": "üìß", "max_reasonable": 150, "description": "–ü—Ä–∏–µ–º –ø—Ä–µ–¥–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –†–ü–û - –ø–∏—Å—å–º–∞"},
    21: {"name": "–í—Ä—É—á–µ–Ω–∏–µ –†–ü–û –ø–æ—Å—ã–ª–∫–∞", "rate": "2‚ÇΩ/—à—Ç", "type": "fixed", "value": 2, "unit": "—à—Ç", "operationType": 4, "emoji": "üì¨", "max_reasonable": 100, "description": "–í—Ä—É—á–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—ã—Ö –ø–æ—á—Ç–æ–≤—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π - –ø–æ—Å—ã–ª–∫–∏"},
    22: {"name": "–í—Ä—É—á–µ–Ω–∏–µ E–ö–û–ú", "rate": "0.5‚ÇΩ/—à—Ç", "type": "fixed", "value": 0.5, "unit": "—à—Ç", "operationType": 4, "emoji": "üì´", "max_reasonable": 200, "description": "–í—Ä—É—á–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º–µ—Ä—Ü–∏–∏"},
    23: {"name": "–ü—Ä–∏–µ–º E–ö–û–ú", "rate": "0.5‚ÇΩ/—à—Ç", "type": "fixed", "value": 0.5, "unit": "—à—Ç", "operationType": 3, "emoji": "üì™", "max_reasonable": 200, "description": "–ü—Ä–∏–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º–µ—Ä—Ü–∏–∏"},
    24: {"name": "–ü—Ä–æ—á–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏", "rate": "0.5‚ÇΩ/—à—Ç", "type": "fixed", "value": 0.5, "unit": "—à—Ç", "operationType": 2, "emoji": "üí≥", "max_reasonable": 100, "description": "–ü—Ä–æ—á–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏"},
    25: {"name": "–£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö", "rate": "10‚ÇΩ (–ù–û–ü–°) / 13‚ÇΩ (–ø–æ—á—Ç–∞–ª—å–æ–Ω)", "type": "fixed", "value": 10, "unit": "—É—Å–ª—É–≥–∞", "operationType": 1, "emoji": "üöÄ", "max_reasonable": 30, "description": "–£—á–∞—Å—Ç–∏–µ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞—Ö"}
}

# –ö–ü–ò –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å HTML)
KPI_CONFIG = {
    "revenue": {"name": "–ö–ü–ò –í—ã—Ä—É—á–∫–∞ –û–ü–°", "placeholder": "% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", "description": "80%+ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ö–ü–ò", "emoji": "üí∞"},
    "csi": {"name": "–ö–ü–ò CSI –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å", "placeholder": "% CSI", "description": "–¢–∞–∫–∂–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Ç–∏–ø–∞ 2", "emoji": "‚≠ê"},
    "online_rpo": {"name": "–ö–ü–ò –î–æ–ª—è –æ–Ω–ª–∞–π–Ω-–†–ü–û", "placeholder": "% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", "emoji": "üåê"},
    "co1_co2": {"name": "–ö–ü–ò CO1/CO2", "placeholder": "% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", "emoji": "üìä"}
}

# –í–µ—Å–∞ –ö–ü–ò –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º (20% –æ—Ç –æ–∫–ª–∞–¥–∞ –æ–±—â–∞—è —Å—É–º–º–∞ –ö–ü–ò)
KPI_WEIGHTS = {
    "admin": {
        "revenue": 0.30,      # 30% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
        "csi": 0.40,          # 40% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò  
        "online_rpo": 0.30    # 30% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
    },
    "nops_operational": {
        "revenue": 0.30,      # 30% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
        "csi": 0.40,          # 40% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
        "online_rpo": 0.15,   # 15% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
        "co1_co2": 0.15       # 15% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
    },
    "nops_management": {
        "revenue": 0.30,      # 30% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
        "csi": 0.40,          # 40% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
        "online_rpo": 0.15,   # 15% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
        "co1_co2": 0.15       # 15% –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –ö–ü–ò
    }
}

# –ö–æ–º–∞–Ω–¥–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
TEAM_COEFFICIENTS_CONFIG = {
    "service": {
        "name": "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–µ—Ä–≤–∏—Å (CSI)",
        "placeholder": "–ë–∞–ª–ª—ã CSI",
        "description": "–í–ª–∏—è–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ 2",
        "type": "service",
        "emoji": "‚≠ê"
    },
    "speed_reception": {
        "name": "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏–µ–º–∞",
        "placeholder": "–í—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö",
        "description": "–í–ª–∏—è–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ 3. –ù–æ—Ä–º–∞: < 4 –º–∏–Ω = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, > 4 –º–∏–Ω = –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ",
        "type": "speed_reception",
        "emoji": "‚ö°"
    },
    "speed_delivery": {
        "name": "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä—É—á–µ–Ω–∏—è",
        "placeholder": "–í—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö",
        "description": "–í–ª–∏—è–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ 4. –ù–æ—Ä–º–∞: < 1:30 –º–∏–Ω = –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, > 1:30 –º–∏–Ω = –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ",
        "type": "speed_delivery",
        "emoji": "üöö"
    },
    "efficiency": {
        "name": "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –û–ü–°",
        "placeholder": "% –≤—ã—Ä—É—á–∫–∏",
        "description": "–í–ª–∏—è–µ—Ç –Ω–∞ –∏—Ç–æ–≥–æ–≤—É—é –ø—Ä–µ–º–∏—é",
        "type": "efficiency",
        "emoji": "üìà"
    }
}

# –†–∞–∑–º–µ—Ä—ã —Å—Ç–∞–≤–æ–∫ (–Ω–æ–≤–æ–µ –≤ v2.4)
POSITION_RATES = {
    "0.3": "0.3 —Å—Ç–∞–≤–∫–∏",
    "0.4": "0.4 —Å—Ç–∞–≤–∫–∏", 
    "0.5": "0.5 —Å—Ç–∞–≤–∫–∏ (–ø–æ–ª—Å—Ç–∞–≤–∫–∏)",
    "0.6": "0.6 —Å—Ç–∞–≤–∫–∏",
    "0.7": "0.7 —Å—Ç–∞–≤–∫–∏",
    "0.8": "0.8 —Å—Ç–∞–≤–∫–∏",
    "0.9": "0.9 —Å—Ç–∞–≤–∫–∏",
    "1.0": "1.0 —Å—Ç–∞–≤–∫–∏ (–ø–æ–ª–Ω–∞—è —Å—Ç–∞–≤–∫–∞)",
    "1.1": "1.1 —Å—Ç–∞–≤–∫–∏",
    "1.2": "1.2 —Å—Ç–∞–≤–∫–∏",
    "1.3": "1.3 —Å—Ç–∞–≤–∫–∏"
}

@dataclass
class UserState:
    """–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è v2.4"""
    position: str = ""
    base_salary: float = 0.0  # –ù–æ–≤–æ–µ –ø–æ–ª–µ - —Ä–∞–∑–º–µ—Ä –æ–∫–ª–∞–¥–∞
    position_rate: float = 0.0  # –ù–æ–≤–æ–µ –ø–æ–ª–µ - —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏
    operations: Dict[int, float] = field(default_factory=dict)  # –û–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ ID
    kpi: Dict[str, float] = field(default_factory=dict)
    team_coefficients: Dict[str, float] = field(default_factory=dict)
    subordinates_bonus: float = 0.0  # –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ –ù–û–ü–°
    
    # –ü–æ–ª—è –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –æ–ø—Ä–æ—Å–Ω–∏–∫–∞
    available_operations: List[int] = field(default_factory=list)
    current_operation_index: int = 0
    
    # –ü–æ–ª—è –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –ö–ü–ò –æ–ø—Ä–æ—Å–Ω–∏–∫–∞
    available_kpi: List[str] = field(default_factory=list)
    current_kpi_index: int = 0
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ü–í–ó WB
    pvz_work_schedule: str = "—Ä–µ–∂–∏–º1"  # —Ä–µ–∂–∏–º1, —Ä–µ–∂–∏–º2, –ø–æ–ª–Ω—ã–π, –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
    pvz_rating: float = 5.0  # —Ä–µ–π—Ç–∏–Ω–≥ –ü–í–ó WB (0-5.0)

# –°–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
MESSAGES = {
    "start": (
        "üëã <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–µ–º–∏–π –û–ü–° v2.4!</b>\n\n"
        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–µ–º–∏—é —Å —É—á–µ—Ç–æ–º:\n"
        "üí∞ –†–∞–∑–º–µ—Ä–∞ –æ–∫–ª–∞–¥–∞ –∏ —Å—Ç–∞–≤–∫–∏\n"
        "üìä –í—Å–µ—Ö 25 —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π\n"
        "‚≠ê –ö–ü–ò –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π\n"
        "‚ö° –ö–æ–º–∞–Ω–¥–Ω—ã—Ö –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤\n\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /calculate –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—á–µ—Ç–∞"
    ),
    "help": (
        "üîç <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º:</b>\n\n"
        "/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n"
        "/calculate - –ù–∞—á–∞—Ç—å —Ä–∞—Å—á–µ—Ç –ø—Ä–µ–º–∏–∏\n"
        "/positions - –°–ø–∏—Å–æ–∫ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π\n"
        "/operations - –°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π\n"
        "/cancel - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞—Å—á–µ—Ç\n\n"
        "ü§ñ –í–µ—Ä—Å–∏—è: v2.4 (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å HTML –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º)"
    ),
    "positions": (
        "üë• <b>–î–æ–ª–∂–Ω–æ—Å—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:</b>\n\n"
        "üë®‚Äçüíº –û–ø–µ—Ä–∞—Ç–æ—Ä 1-3 –∫–ª–∞—Å—Å–∞\n"
        "üë®‚Äçüíº –ù–û–ü–° –±–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤\n"
        "üë®‚Äç‚úàÔ∏è –ù–û–ü–° —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏\n"
        "üë®‚Äçüíª –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\n"
        "üö∂‚Äç‚ôÇÔ∏è –ü–æ—á—Ç–∞–ª—å–æ–Ω\n"
        "üë®‚Äçüî¨ –ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç\n\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /calculate –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–µ–º–∏–∏"
    )
} 